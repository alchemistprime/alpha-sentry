<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AlphaSentry â€” Architecture Flow</title>
  <style>
    body { background: #0d1117; color: #c9d1d9; font-family: system-ui, sans-serif; margin: 0; padding: 2rem; }
    h1 { color: #58a6ff; font-size: 1.4rem; margin-bottom: 0.5rem; }
    p.sub { color: #8b949e; font-size: 0.85rem; margin-bottom: 1.5rem; }
    .mermaid { background: #161b22; border-radius: 8px; padding: 2rem; overflow-x: auto; margin-bottom: 2rem; }
  </style>
</head>
<body>
  <h1>AlphaSentry â€” Architecture Flow</h1>
  <p class="sub">Mermaid flowchart of the codebase architecture.</p>

  <div class="mermaid">
flowchart TD
    subgraph Entry["Entry Points"]
        STUDIO["ðŸŽ› Mastra Studio\nbun run studio"]
        CLI["âŒ¨ CLI\nbun start"]
        WEB["ðŸŒ Web App\nlocalhost:3000"]
    end

    subgraph Orchestration["Orchestration"]
        HOOK["useAgentRunner\nsrc/hooks/useAgentRunner.ts"]
        MASTRA["Mastra Instance\nsrc/mastra/index.ts"]
        AGENT["AlphaSentry Agent\nsrc/mastra/agents/alpha-sentry.ts"]
        BRIDGE["Event Bridge\nsrc/mastra/event-bridge.ts"]
    end

    subgraph LLM["LLM Layer"]
        ROUTER["Model Router\nsrc/mastra/model-router.ts"]
        PROVIDERS["Providers\nOpenAI Â· Anthropic Â· Google Â· xAI"]
    end

    subgraph Memory["Memory & Storage"]
        MEMORY["Mastra Memory\nsrc/mastra/memory.ts"]
        LIBSQL["LibSQL / Turso"]
        AUDIT["Audit Log\n.dexter/scratchpad/"]
    end

    subgraph Tools["Tools"]
        FS["financial_search"]
        FM["financial_metrics"]
        RF["read_filings"]
        WS["web_search"]
        WF["web_fetch"]
        BR["browser"]
        SK["skill"]
    end

    subgraph FinanceRouter["Financial Router"]
        ROUTER_INNER["Sub-Agent\nprices Â· fundamentals Â· filings\nestimates Â· news Â· crypto"]
    end

    subgraph External["External APIs"]
        FD_API["Financial Datasets API"]
        SEARCH_API["Exa / Tavily"]
        PLAYWRIGHT["Playwright"]
    end

    STUDIO --> MASTRA
    CLI --> HOOK
    WEB --> HOOK
    HOOK --> AGENT
    MASTRA --> AGENT

    AGENT --> ROUTER
    ROUTER --> PROVIDERS

    AGENT <--> MEMORY
    MEMORY <--> LIBSQL
    AGENT --> BRIDGE
    BRIDGE --> HOOK
    BRIDGE --> AUDIT

    AGENT --> FS
    AGENT --> FM
    AGENT --> RF
    AGENT --> WS
    AGENT --> WF
    AGENT --> BR
    AGENT --> SK

    FS --> ROUTER_INNER
    ROUTER_INNER --> FD_API
    WS --> SEARCH_API
    WF --> External
    BR --> PLAYWRIGHT
  </div>

  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
    mermaid.initialize({
      startOnLoad: true,
      theme: 'dark',
      flowchart: { curve: 'basis', padding: 20 },
    });
  </script>
</body>
</html>
